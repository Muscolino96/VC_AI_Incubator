<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>VC AI Incubator</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=JetBrains+Mono:wght@300;400;500;600&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TOKENS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
:root {
  --ink: #0c0d10;
  --ink-2: #141519;
  --surface: #1a1b20;
  --surface-2: #20222a;
  --border: rgba(255,255,255,.07);
  --border-hi: rgba(255,255,255,.14);
  --text: #e8e9ec;
  --text-dim: #8a8c96;
  --text-xs: #5a5c68;

  --gold: #d4a853;
  --gold-dim: rgba(212,168,83,.13);
  --gold-glow: rgba(212,168,83,.35);

  /* slot / provider colours */
  --c-openai: #10b981;
  --c-anthropic: #cc785c;
  --c-compat: #6d7aff;  /* for both generic compat slots */
  --c-mistral: #ff7000;
  --c-google: #8b5cf6;
  --c-deepseek: #3b82f6;
  --c-xai: #e2e2e2;
  --c-meta: #0082fb;
  --c-cohere: #39d353;
  --c-qwen: #ed6c18;

  --green: #22c55e;
  --red: #ef4444;
  --yellow: #eab308;

  --font-mono: 'JetBrains Mono', monospace;
  --font-sans: 'DM Sans', sans-serif;
  --font-serif: 'DM Serif Display', serif;
  --r: 10px;
  --r-lg: 16px;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body {
  font-family: var(--font-sans);
  background: var(--ink);
  color: var(--text);
  line-height: 1.55;
  font-size: 14px;
  min-height: 100vh;
}
body::before {
  content: '';
  position: fixed; inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.025'/%3E%3C/svg%3E");
  pointer-events: none; z-index: 0;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.shell { max-width: 1420px; margin: 0 auto; padding: 0 28px 80px; position: relative; z-index: 1; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
header {
  display: flex; justify-content: space-between; align-items: center;
  padding: 22px 0 18px;
  border-bottom: 1px solid var(--border);
  margin-bottom: 32px;
}
.wordmark { display: flex; align-items: baseline; gap: 10px; }
.wordmark-vc { font-family: var(--font-serif); font-size: 27px; color: var(--gold); }
.wordmark-rest { font-family: var(--font-sans); font-size: 12px; font-weight: 600; letter-spacing: 3px; text-transform: uppercase; color: var(--text-dim); }
.ws-badge {
  display: flex; align-items: center; gap: 6px;
  font-family: var(--font-mono); font-size: 11px; color: var(--text-dim);
  background: var(--surface); border: 1px solid var(--border); padding: 5px 12px; border-radius: 20px;
}
.ws-dot { width: 7px; height: 7px; border-radius: 50%; background: var(--red); transition: background .3s; }
.ws-dot.live { background: var(--green); box-shadow: 0 0 6px var(--green); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SECTION LABEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section-label {
  font-family: var(--font-mono); font-size: 10px; font-weight: 500;
  letter-spacing: 2px; text-transform: uppercase; color: var(--gold);
  margin-bottom: 14px;
  display: flex; align-items: center; gap: 10px;
}
.section-label::after { content: ''; flex: 1; height: 1px; background: linear-gradient(90deg, var(--border-hi), transparent); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--r-lg); padding: 22px; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ FORMS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
label { display: block; font-size: 11px; font-weight: 500; letter-spacing: .5px; text-transform: uppercase; color: var(--text-dim); margin-bottom: 5px; }
input, select {
  width: 100%; background: var(--ink-2); color: var(--text);
  border: 1px solid var(--border); padding: 8px 11px; border-radius: 8px;
  font-family: var(--font-sans); font-size: 13px; outline: none; appearance: none;
  transition: border-color .15s, box-shadow .15s;
}
input:focus, select:focus { border-color: var(--gold); box-shadow: 0 0 0 2px var(--gold-dim); }
input[type="password"] { font-family: var(--font-mono); letter-spacing: 2px; font-size: 12px; }
input::placeholder { color: var(--text-xs); }
select {
  cursor: pointer;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='7'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%238a8c96' fill='none' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E");
  background-repeat: no-repeat; background-position: right 11px center; padding-right: 30px;
}
select option { background: #1a1b20; }
.field { margin-bottom: 14px; }
.field:last-child { margin-bottom: 0; }
.field-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.field-hint { font-size: 11px; color: var(--text-xs); margin-top: 3px; font-style: italic; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn {
  display: inline-flex; align-items: center; gap: 7px;
  border: none; border-radius: 8px; cursor: pointer;
  font-family: var(--font-sans); font-weight: 600; font-size: 13px; padding: 9px 18px;
  transition: all .15s;
}
.btn:disabled { opacity: .35; cursor: not-allowed; }
.btn-primary {
  background: var(--gold); color: #0c0d10; font-size: 14px; padding: 11px 26px;
}
.btn-primary:not(:disabled):hover { background: #e0b561; box-shadow: 0 4px 20px var(--gold-glow); transform: translateY(-1px); }
.btn-ghost { background: var(--surface-2, #20222a); color: var(--text-dim); border: 1px solid var(--border); }
.btn-ghost:hover { border-color: var(--border-hi); color: var(--text); }
.btn svg { width: 14px; height: 14px; stroke-width: 2; fill: none; stroke: currentColor; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CONFIG LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.config-outer {
  display: grid;
  grid-template-columns: 320px 1fr;
  gap: 20px;
  margin-bottom: 28px;
}
.config-left { display: flex; flex-direction: column; gap: 16px; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ API NOTICE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.api-notice {
  display: flex; gap: 9px; padding: 11px 13px;
  background: rgba(212,168,83,.06); border: 1px solid rgba(212,168,83,.2); border-radius: 8px;
  font-size: 11px; color: #b8956a; line-height: 1.5; margin-top: 10px;
}
.api-notice svg { flex-shrink: 0; margin-top: 1px; stroke: var(--gold); fill: none; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ LAUNCH BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.launch-bar { display: flex; align-items: center; gap: 12px; padding-top: 16px; border-top: 1px solid var(--border); margin-top: 2px; }
.run-status-text { font-family: var(--font-mono); font-size: 11px; color: var(--text-dim); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TEAM BUILDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.team-builder {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r-lg);
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.team-builder-head {
  padding: 20px 24px 14px;
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 12px;
}
.team-builder-head h2 { font-family: var(--font-serif); font-size: 19px; font-weight: 400; margin-bottom: 2px; }
.team-builder-head p { font-size: 12px; color: var(--text-dim); }

/* 4-slot strip at top */
.slot-strip {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1fr;
  border-bottom: 1px solid var(--border);
}

.slot-btn {
  padding: 14px 16px;
  cursor: pointer;
  border-right: 1px solid var(--border);
  transition: background .15s;
  position: relative;
}
.slot-btn:last-child { border-right: none; }
.slot-btn:hover { background: rgba(255,255,255,.02); }
.slot-btn.active { background: rgba(255,255,255,.03); }
.slot-btn.active::after {
  content: '';
  position: absolute; bottom: 0; left: 0; right: 0; height: 2px;
  background: currentColor;
}

.slot-label {
  font-family: var(--font-mono);
  font-size: 9px; font-weight: 600; letter-spacing: 1.5px; text-transform: uppercase;
  color: var(--text-xs); margin-bottom: 5px;
}
.slot-type {
  font-size: 10px; color: var(--text-dim); margin-bottom: 8px;
}
.slot-selected-name { font-size: 13px; font-weight: 600; color: var(--text); }
.slot-selected-price { font-family: var(--font-mono); font-size: 10px; color: var(--text-xs); margin-top: 2px; }

/* Slot accent colours */
.slot-btn[data-slot="0"] { color: var(--c-openai); }
.slot-btn[data-slot="1"] { color: var(--c-anthropic); }
.slot-btn[data-slot="2"] { color: var(--c-compat); }
.slot-btn[data-slot="3"] { color: var(--c-compat); }

/* active dot */
.slot-dot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; display: inline-block; margin-right: 5px; vertical-align: middle; }

/* â”€â”€ Model picker panel â”€â”€ */
.picker-panel {
  flex: 1;
  display: none;
  flex-direction: column;
  min-height: 0;
  overflow: hidden;
}
.picker-panel.active { display: flex; }

/* Provider selector row (only for compat slots) */
.provider-selector {
  display: flex; gap: 0;
  border-bottom: 1px solid var(--border);
  overflow-x: auto;
  scrollbar-width: none;
}
.provider-selector::-webkit-scrollbar { display: none; }
.prov-tab {
  flex-shrink: 0;
  padding: 10px 14px;
  cursor: pointer;
  font-size: 11px; font-weight: 600;
  color: var(--text-xs);
  border-bottom: 2px solid transparent;
  white-space: nowrap;
  transition: all .15s;
  display: flex; align-items: center; gap: 5px;
}
.prov-tab:hover { color: var(--text); }
.prov-tab.active { color: var(--text); border-bottom-color: currentColor; }
.prov-tab .pd { width: 8px; height: 8px; border-radius: 2px; flex-shrink: 0; }

/* Model list */
.model-scroll {
  flex: 1;
  overflow-y: auto;
  padding: 14px 18px;
}
.model-scroll::-webkit-scrollbar { width: 4px; }
.model-scroll::-webkit-scrollbar-thumb { background: var(--border-hi); border-radius: 2px; }

.model-group-label {
  font-family: var(--font-mono); font-size: 9px; letter-spacing: 1.5px; text-transform: uppercase;
  color: var(--text-xs); padding: 8px 0 6px; border-bottom: 1px solid var(--border); margin-bottom: 8px;
}

.model-row {
  display: flex; align-items: flex-start; gap: 11px;
  padding: 10px 12px; border-radius: 8px;
  cursor: pointer; transition: background .12s;
  border: 1px solid transparent;
  margin-bottom: 4px;
}
.model-row:hover { background: var(--ink-2); }
.model-row.selected { background: var(--ink-2); border-color: currentColor; }
.model-row input[type="radio"] { display: none; }

.model-radio-dot {
  width: 15px; height: 15px; border-radius: 50%;
  border: 2px solid var(--border-hi); flex-shrink: 0; margin-top: 1px;
  display: flex; align-items: center; justify-content: center;
  transition: all .12s;
}
.model-row.selected .model-radio-dot {
  background: currentColor; border-color: currentColor;
}
.model-row.selected .model-radio-dot::after {
  content: ''; width: 5px; height: 5px; border-radius: 50%; background: var(--ink);
}

.model-info { flex: 1; min-width: 0; }
.model-name { font-size: 13px; font-weight: 500; line-height: 1.2; margin-bottom: 4px; }
.model-tagrow { display: flex; gap: 5px; flex-wrap: wrap; margin-bottom: 3px; }
.tag {
  font-family: var(--font-mono); font-size: 9px; padding: 1px 6px; border-radius: 3px;
  border: 1px solid rgba(255,255,255,.07); color: var(--text-xs);
}
.tag.price { color: var(--gold); border-color: rgba(212,168,83,.25); }
.tag.ctx { color: #60a5fa; border-color: rgba(96,165,250,.2); }
.tag.tier-flagship { color: var(--text-dim); border-color: rgba(255,255,255,.1); }
.tag.tier-fast { color: var(--green); border-color: rgba(34,197,94,.2); }
.tag.tier-cheap { color: #f97316; border-color: rgba(249,115,22,.2); }
.model-desc { font-size: 11px; color: var(--text-xs); line-height: 1.4; }

/* Base URL row (compat slots only) */
.base-url-row {
  padding: 12px 18px;
  border-top: 1px solid var(--border);
  display: flex; align-items: center; gap: 10px;
}
.base-url-row label { margin-bottom: 0; white-space: nowrap; flex-shrink: 0; }
.base-url-row input { font-family: var(--font-mono); font-size: 11px; }

/* Team summary strip */
.team-summary {
  padding: 12px 18px;
  border-top: 1px solid var(--border);
  display: flex; gap: 8px; flex-wrap: wrap; align-items: center;
}
.team-chip {
  display: flex; align-items: center; gap: 5px;
  font-size: 11px; font-weight: 500; padding: 3px 10px;
  border-radius: 20px; border: 1px solid var(--border); background: var(--ink-2);
}
.team-chip-dot { width: 5px; height: 5px; border-radius: 50%; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PROGRESS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.progress-block { display: none; margin-bottom: 28px; }
.progress-block.visible { display: block; }
.progress-inner { background: var(--surface); border: 1px solid var(--border); border-radius: var(--r-lg); overflow: hidden; }
.progress-top { display: flex; justify-content: space-between; align-items: center; padding: 18px 24px 14px; }
.progress-title { font-family: var(--font-serif); font-size: 17px; font-weight: 400; margin-bottom: 2px; }
.progress-sub { font-family: var(--font-mono); font-size: 11px; color: var(--text-dim); }

.stage-track { display: flex; align-items: center; padding: 4px 24px 18px; }
.stage-node { flex: 1; display: flex; align-items: center; }
.stage-node:last-child { flex: none; }
.stage-pill {
  display: flex; align-items: center; gap: 8px;
  padding: 8px 15px; border-radius: 20px; border: 1px solid var(--border);
  background: var(--ink-2); font-size: 12px; font-weight: 500; color: var(--text-xs);
  transition: all .3s; white-space: nowrap;
}
.stage-pill .snum {
  font-family: var(--font-mono); font-size: 10px; width: 17px; height: 17px;
  border-radius: 50%; background: var(--border); display: flex; align-items: center; justify-content: center; flex-shrink: 0;
}
.stage-pill.active { border-color: var(--gold); background: var(--gold-dim); color: var(--gold); animation: stagePulse 2s infinite; }
.stage-pill.active .snum { background: var(--gold); color: var(--ink); }
.stage-pill.done { border-color: rgba(34,197,94,.3); background: rgba(34,197,94,.06); color: var(--green); }
.stage-pill.done .snum { background: var(--green); color: var(--ink); font-size: 0; }
.stage-pill.done .snum::after { content: 'âœ“'; font-size: 10px; }
.stage-line { flex: 1; height: 1px; background: var(--border); margin: 0 8px; }
@keyframes stagePulse {
  0%, 100% { box-shadow: 0 0 0 0 var(--gold-glow); }
  50% { box-shadow: 0 0 0 5px transparent; }
}

.pbar-track { height: 3px; background: var(--ink); }
.pbar-fill { height: 100%; background: linear-gradient(90deg, var(--gold), #f0c070); transition: width .4s ease; border-radius: 0 2px 2px 0; }

.event-log { border-top: 1px solid var(--border); padding: 14px 20px; max-height: 200px; overflow-y: auto; }
.event-log::-webkit-scrollbar { width: 3px; }
.event-log::-webkit-scrollbar-thumb { background: var(--border-hi); }
.event-row { display: flex; gap: 9px; padding: 2px 0; font-family: var(--font-mono); font-size: 11px; border-bottom: 1px solid rgba(255,255,255,.025); }
.event-row:last-child { border-bottom: none; }
.ets { color: var(--text-xs); flex-shrink: 0; }
.etyp { flex-shrink: 0; padding: 0 5px; border-radius: 3px; font-size: 9px; background: rgba(255,255,255,.04); color: var(--gold); align-self: flex-start; margin-top: 1px; }
.emsg { color: var(--text-dim); flex: 1; }
.eprov { color: var(--c-compat); font-size: 10px; flex-shrink: 0; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.main-tabs { display: flex; gap: 2px; border-bottom: 1px solid var(--border); margin-bottom: 26px; }
.main-tab {
  padding: 9px 17px; cursor: pointer; font-size: 12px; font-weight: 500; letter-spacing: .3px;
  color: var(--text-dim); border-bottom: 2px solid transparent; margin-bottom: -1px;
  border-radius: 4px 4px 0 0; transition: all .15s;
}
.main-tab:hover { color: var(--text); background: rgba(255,255,255,.02); }
.main-tab.active { color: var(--gold); border-bottom-color: var(--gold); background: var(--gold-dim); }
.tab-pane { display: none; }
.tab-pane.active { display: block; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ EMPTY STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.empty-state { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 70px 40px; text-align: center; }
.empty-icon { font-size: 44px; margin-bottom: 14px; opacity: .4; }
.empty-state h3 { font-family: var(--font-serif); font-size: 20px; color: var(--text-dim); font-weight: 400; margin-bottom: 6px; }
.empty-state p { font-size: 13px; color: var(--text-xs); max-width: 300px; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ RUN HISTORY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.data-table { width: 100%; border-collapse: collapse; }
.data-table th { text-align: left; padding: 8px 14px; font-family: var(--font-mono); font-size: 10px; font-weight: 500; letter-spacing: 1px; text-transform: uppercase; color: var(--text-xs); border-bottom: 1px solid var(--border); }
.data-table td { padding: 12px 14px; font-size: 13px; border-bottom: 1px solid rgba(255,255,255,.03); vertical-align: middle; }
.data-table tr:hover td { background: rgba(255,255,255,.012); }
.status-badge {
  display: inline-flex; align-items: center; gap: 5px; padding: 3px 9px; border-radius: 20px;
  font-family: var(--font-mono); font-size: 10px; font-weight: 500; letter-spacing: .5px;
}
.status-badge.complete { background: rgba(34,197,94,.1); color: var(--green); border: 1px solid rgba(34,197,94,.25); }
.status-badge.running { background: rgba(212,168,83,.1); color: var(--gold); border: 1px solid rgba(212,168,83,.25); animation: stagePulse 2s infinite; }
.status-badge.error { background: rgba(239,68,68,.1); color: var(--red); border: 1px solid rgba(239,68,68,.25); }
.status-badge.starting { background: rgba(109,122,255,.1); color: #a5b4fc; border: 1px solid rgba(109,122,255,.25); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ IDEA GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.idea-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); gap: 14px; }
.idea-card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--r-lg); padding: 18px; transition: border-color .2s, transform .18s; }
.idea-card:hover { border-color: var(--border-hi); transform: translateY(-2px); }
.idea-top { display: flex; align-items: flex-start; justify-content: space-between; gap: 10px; margin-bottom: 10px; }
.idea-title { font-size: 14px; font-weight: 600; line-height: 1.3; }
.provider-badge {
  display: inline-flex; align-items: center; gap: 4px; padding: 2px 8px;
  border-radius: 4px; font-family: var(--font-mono); font-size: 9px; font-weight: 700;
  letter-spacing: 1px; text-transform: uppercase; flex-shrink: 0; border: 1px solid currentColor;
}
.provider-badge.openai { color: var(--c-openai); }
.provider-badge.anthropic { color: var(--c-anthropic); }
.idea-summary { font-size: 12px; color: var(--text-dim); margin-bottom: 12px; line-height: 1.6; }
.idea-details { display: flex; flex-direction: column; gap: 6px; }
.idea-drow { display: flex; gap: 8px; font-size: 12px; }
.idea-dlabel { font-family: var(--font-mono); font-size: 9px; font-weight: 500; letter-spacing: .5px; text-transform: uppercase; color: var(--text-xs); flex-shrink: 0; padding-top: 2px; min-width: 50px; }
.idea-dval { color: var(--text-dim); line-height: 1.5; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PLAN ACCORDION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.plan-accordion { display: flex; flex-direction: column; gap: 8px; }
details.plan-item { background: var(--surface); border: 1px solid var(--border); border-radius: var(--r-lg); overflow: hidden; }
details.plan-item[open] { border-color: var(--border-hi); }
details.plan-item[open] summary { border-bottom: 1px solid var(--border); }
details.plan-item summary { list-style: none; cursor: pointer; padding: 16px 20px; display: flex; align-items: center; gap: 12px; user-select: none; }
details.plan-item summary::-webkit-details-marker { display: none; }
details.plan-item summary:hover { background: rgba(255,255,255,.015); }
.plan-chevron { width: 18px; height: 18px; border: 1px solid var(--border); border-radius: 5px; display: flex; align-items: center; justify-content: center; transition: transform .2s, background .15s; flex-shrink: 0; }
details[open] .plan-chevron { transform: rotate(90deg); background: var(--gold-dim); border-color: var(--gold); }
.plan-chevron svg { width: 10px; height: 10px; stroke: var(--text-dim); fill: none; }
.plan-summary-text { flex: 1; }
.plan-summary-text strong { font-size: 13px; font-weight: 600; }
.plan-summary-text span { font-family: var(--font-mono); font-size: 11px; color: var(--text-xs); display: block; margin-top: 2px; }
.plan-body { padding: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 18px; }
.plan-sec h4 { font-family: var(--font-mono); font-size: 9px; font-weight: 500; letter-spacing: 1.5px; text-transform: uppercase; color: var(--gold); margin-bottom: 7px; }
.plan-sec p { font-size: 12px; color: var(--text-dim); line-height: 1.65; }
.plan-sec.full { grid-column: 1 / -1; }
.market-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 7px; margin-bottom: 8px; }
.market-cell { background: var(--ink-2); border: 1px solid var(--border); border-radius: 7px; padding: 9px 11px; }
.market-cell-label { font-family: var(--font-mono); font-size: 9px; letter-spacing: 1px; text-transform: uppercase; color: var(--text-xs); margin-bottom: 3px; }
.market-cell-val { font-size: 12px; font-weight: 500; }
.risk-list { display: flex; flex-direction: column; gap: 7px; }
.risk-row { display: flex; gap: 8px; align-items: flex-start; }
.risk-badge { font-family: var(--font-mono); font-size: 9px; font-weight: 600; padding: 2px 6px; border-radius: 3px; flex-shrink: 0; margin-top: 1px; letter-spacing: .5px; }
.risk-badge.critical { background: rgba(239,68,68,.15); color: #f87171; }
.risk-badge.high { background: rgba(234,179,8,.12); color: #fbbf24; }
.risk-badge.medium { background: rgba(59,130,246,.12); color: #93c5fd; }
.risk-badge.low { background: rgba(34,197,94,.1); color: #86efac; }
.risk-text { font-size: 12px; color: var(--text-dim); line-height: 1.5; }
.competitor-list { display: flex; flex-direction: column; gap: 8px; }
.competitor-row { background: var(--ink-2); border: 1px solid var(--border); border-radius: 7px; padding: 9px 12px; }
.competitor-name { font-size: 12px; font-weight: 600; margin-bottom: 5px; }
.competitor-meta { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; }
.competitor-fact { font-size: 11px; color: var(--text-dim); }
.competitor-fact strong { font-family: var(--font-mono); font-size: 9px; text-transform: uppercase; letter-spacing: .5px; color: var(--text-xs); display: block; margin-bottom: 1px; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PITCH CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.pitch-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 16px; }
.pitch-card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--r-lg); padding: 20px; transition: border-color .2s; }
.pitch-card:hover { border-color: var(--border-hi); }
.pitch-elevator { font-family: var(--font-serif); font-size: 14px; font-style: italic; line-height: 1.55; margin: 12px 0 14px; padding: 12px 14px; border-left: 2px solid var(--gold); background: var(--gold-dim); border-radius: 0 6px 6px 0; }
.pitch-ask { font-size: 12px; color: var(--text-dim); padding: 9px 12px; background: var(--ink-2); border: 1px solid var(--border); border-radius: 7px; margin-bottom: 13px; }
.investor-votes { border-top: 1px solid var(--border); padding-top: 13px; margin-top: 13px; }
.vote-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 9px; }
.vote-header-label { font-family: var(--font-mono); font-size: 10px; letter-spacing: 1px; text-transform: uppercase; color: var(--text-xs); }
.vote-score-big { font-family: var(--font-serif); font-size: 22px; }
.vote-row { display: flex; align-items: center; gap: 9px; padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,.03); }
.vote-row:last-child { border-bottom: none; }
.vote-dec { font-family: var(--font-mono); font-size: 10px; font-weight: 700; padding: 2px 7px; border-radius: 3px; flex-shrink: 0; }
.vote-dec.invest { background: rgba(34,197,94,.12); color: var(--green); }
.vote-dec.pass { background: rgba(239,68,68,.1); color: var(--red); }
.vote-investor { font-size: 12px; flex: 1; }
.vote-conv { font-family: var(--font-mono); font-size: 12px; color: var(--gold); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PORTFOLIO HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.portfolio-hero { background: linear-gradient(135deg, var(--ink) 0%, rgba(212,168,83,.04) 100%); border: 1px solid var(--border); border-top: 2px solid var(--gold); border-radius: var(--r-lg); overflow: hidden; margin-bottom: 22px; }
.portfolio-header { display: flex; justify-content: space-between; align-items: flex-start; padding: 26px 30px 18px; border-bottom: 1px solid var(--border); }
.portfolio-title { font-family: var(--font-serif); font-size: 28px; font-weight: 400; line-height: 1.1; margin-bottom: 3px; }
.portfolio-subtitle { font-size: 12px; color: var(--text-dim); }
.portfolio-meta { text-align: right; font-family: var(--font-mono); font-size: 11px; color: var(--text-xs); }
.portfolio-meta strong { display: block; font-size: 22px; color: var(--gold); font-family: var(--font-sans); font-weight: 700; }
.portfolio-table-wrap { overflow-x: auto; }
.portfolio-table { width: 100%; border-collapse: collapse; }
.portfolio-table th { text-align: left; padding: 9px 20px; font-family: var(--font-mono); font-size: 9px; font-weight: 500; letter-spacing: 1.5px; text-transform: uppercase; color: var(--text-xs); border-bottom: 1px solid var(--border); white-space: nowrap; }
.portfolio-table td { padding: 15px 20px; border-bottom: 1px solid rgba(255,255,255,.03); vertical-align: top; }
.portfolio-table tr:last-child td { border-bottom: none; }
.portfolio-table tr:hover td { background: rgba(212,168,83,.02); }
.rank-num { font-family: var(--font-serif); font-size: 26px; font-weight: 400; line-height: 1; }
.rank-1 { color: var(--gold); }
.rank-2 { color: #c0c0c0; }
.rank-3 { color: #cd7f32; }
.pitch-cell { max-width: 380px; font-size: 12px; color: var(--text-dim); line-height: 1.55; font-style: italic; }
.votes-fraction { font-family: var(--font-mono); font-size: 14px; font-weight: 500; }
.votes-bar { margin-top: 4px; height: 3px; background: var(--border); border-radius: 2px; width: 60px; }
.votes-bar-fill { height: 100%; border-radius: 2px; background: var(--green); }
.conviction-ring { width: 46px; height: 46px; margin: 0 auto; position: relative; }
.conviction-ring svg { transform: rotate(-90deg); }
.conviction-ring .val { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-family: var(--font-mono); font-size: 11px; font-weight: 500; }
.ask-cell { font-family: var(--font-mono); font-size: 11px; color: var(--text-dim); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media (max-width: 960px) {
  .config-outer { grid-template-columns: 1fr; }
  .slot-strip { grid-template-columns: 1fr 1fr; }
  .plan-body { grid-template-columns: 1fr; }
  .portfolio-table th:nth-child(4), .portfolio-table td:nth-child(4) { display: none; }
}
::-webkit-scrollbar { width: 5px; height: 5px; }
::-webkit-scrollbar-thumb { background: var(--border-hi); border-radius: 3px; }
</style>
</head>
<body>
<div class="shell">

<!-- HEADER -->
<header>
  <div class="wordmark">
    <span class="wordmark-vc">VC</span>
    <span class="wordmark-rest">AI&nbsp;Incubator</span>
  </div>
  <div class="ws-badge" id="wsStatus">
    <span class="ws-dot" id="wsDot"></span>
    <span id="wsLabel">Connectingâ€¦</span>
  </div>
</header>

<!-- CONFIG -->
<div class="section-label">Pipeline Configuration</div>

<div class="config-outer">

  <!-- LEFT -->
  <div class="config-left">
    <div class="card">
      <div class="section-label" style="margin-bottom:16px">Run settings</div>
      <div class="field-row">
        <div class="field">
          <label>Ideas per model</label>
          <select id="cfgIdeas">
            <option value="3">3</option><option value="5" selected>5</option>
            <option value="7">7</option><option value="10">10</option>
          </select>
        </div>
        <div class="field">
          <label>Iteration rounds</label>
          <select id="cfgIter">
            <option value="1">1</option><option value="2">2</option><option value="3" selected>3</option>
          </select>
        </div>
      </div>
      <div class="field">
        <label>Sector focus</label>
        <input type="text" id="cfgSector" placeholder="Healthcare, Fintech, Climate Techâ€¦">
        <div class="field-hint">Leave blank for all sectors</div>
      </div>
      <div class="field">
        <label>Mode</label>
        <select id="cfgMock">
          <option value="true">Mock â€” no API calls (testing)</option>
          <option value="false">Live â€” real API calls</option>
        </select>
      </div>
    </div>

    <div class="card" id="apiKeySection">
      <div class="section-label" style="margin-bottom:16px">API keys</div>
      <div class="field"><label>OpenAI</label><input type="password" id="keyOpenai" placeholder="sk-â€¦" disabled></div>
      <div class="field"><label>Anthropic</label><input type="password" id="keyAnthropic" placeholder="sk-ant-â€¦" disabled></div>
      <div class="field"><label>Compatible slot 3</label><input type="password" id="keyCompat1" placeholder="API keyâ€¦" disabled></div>
      <div class="field" style="margin-bottom:0"><label>Compatible slot 4</label><input type="password" id="keyCompat2" placeholder="API keyâ€¦" disabled></div>
      <div class="api-notice">
        <svg width="14" height="14" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        Keys sent to your local server only. Use a <code style="font-size:10px">.env</code> file for production.
      </div>
    </div>

    <div class="card">
      <div class="launch-bar">
        <button class="btn btn-primary" id="btnRun" onclick="startRun()">
          <svg viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"/></svg>
          Launch
        </button>
        <button class="btn btn-ghost" onclick="loadRuns()">Refresh</button>
        <span class="run-status-text" id="runStatus"></span>
      </div>
    </div>
  </div>

  <!-- RIGHT: TEAM BUILDER -->
  <div class="team-builder">
    <div class="team-builder-head">
      <div>
        <h2>Assemble Your AI Panel</h2>
        <p>4 providers compete as founders, advisors, and investors. Slots 3 &amp; 4 accept any OpenAI-compatible API.</p>
      </div>
    </div>

    <!-- Slot tabs -->
    <div class="slot-strip" id="slotStrip"></div>

    <!-- Picker panels (one per slot) -->
    <div id="pickerPanels" style="flex:1;display:flex;flex-direction:column;min-height:380px;overflow:hidden;"></div>

    <!-- Team summary -->
    <div class="team-summary" id="teamSummary"></div>
  </div>
</div>

<!-- PROGRESS -->
<div class="progress-block" id="progressBlock">
  <div class="section-label" style="margin-bottom:12px">Pipeline progress</div>
  <div class="progress-inner">
    <div class="progress-top">
      <div>
        <div class="progress-title">Runningâ€¦</div>
        <div class="progress-sub" id="progressSub">Initialising</div>
      </div>
    </div>
    <div class="stage-track">
      <div class="stage-node">
        <div class="stage-pill" id="pill1"><div class="snum">1</div>Ideate &amp; Select</div>
      </div>
      <div class="stage-line"></div>
      <div class="stage-node">
        <div class="stage-pill" id="pill2"><div class="snum">2</div>Build &amp; Iterate</div>
      </div>
      <div class="stage-line"></div>
      <div class="stage-node">
        <div class="stage-pill" id="pill3"><div class="snum">3</div>Seed Pitch</div>
      </div>
    </div>
    <div class="pbar-track"><div class="pbar-fill" id="pbarFill" style="width:0%"></div></div>
    <div class="event-log" id="eventLog"></div>
  </div>
</div>

<!-- TABS -->
<div class="main-tabs">
  <div class="main-tab active" data-tab="runs" onclick="switchTab('runs')">Run History</div>
  <div class="main-tab" data-tab="ideas" onclick="switchTab('ideas')">Ideas</div>
  <div class="main-tab" data-tab="plans" onclick="switchTab('plans')">Startup Plans</div>
  <div class="main-tab" data-tab="pitches" onclick="switchTab('pitches')">Pitches &amp; Decisions</div>
  <div class="main-tab" data-tab="portfolio" onclick="switchTab('portfolio')">Portfolio Report</div>
</div>

<div class="tab-pane active" id="pane-runs">
  <div id="runsList"><div class="empty-state"><div class="empty-icon">ğŸ“‹</div><h3>No runs yet</h3><p>Configure the panel above and click Launch.</p></div></div>
</div>
<div class="tab-pane" id="pane-ideas"><div id="ideasContent"><div class="empty-state"><div class="empty-icon">ğŸ’¡</div><h3>No ideas yet</h3><p>Ideas generated in Stage 1 appear here.</p></div></div></div>
<div class="tab-pane" id="pane-plans"><div id="plansContent"><div class="empty-state"><div class="empty-icon">ğŸ“</div><h3>No plans yet</h3><p>Startup plans appear after Stage 2.</p></div></div></div>
<div class="tab-pane" id="pane-pitches"><div id="pitchesContent"><div class="empty-state"><div class="empty-icon">ğŸ¤</div><h3>No pitches yet</h3><p>Pitches and investor decisions appear after Stage 3.</p></div></div></div>
<div class="tab-pane" id="pane-portfolio"><div id="portfolioContent"><div class="empty-state"><div class="empty-icon">ğŸ†</div><h3>Portfolio pending</h3><p>Ranked results appear once the pipeline completes.</p></div></div></div>

</div><!-- /shell -->

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FULL MARKET MODEL CATALOG â€” February 2026
   Organised by API wire type, then by company/model.
   Pricing: USD per 1M tokens (input / output).
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const SLOTS = [
  /* â”€â”€ Slot 0: OpenAI Responses API (locked to OpenAI) â”€â”€â”€â”€â”€â”€â”€ */
  {
    label: 'Slot 1',
    type: 'OpenAI Responses API',
    color: 'var(--c-openai)',
    keyField: 'keyOpenai',
    configKey: 'openai',        // maps to models.openai in server config
    fixed: true,                // provider company is fixed
    defaultModel: 'gpt-5.2',
    providers: [
      {
        name: 'OpenAI',
        color: 'var(--c-openai)',
        baseUrl: 'https://api.openai.com/v1',
        models: [
          { id:'gpt-5.2',       name:'GPT-5.2',         price:'$1.75 / $14',  ctx:'400K',  tier:'flagship', desc:'Flagship agentic model with xhigh reasoning effort. Best price among frontier tier.' },
          { id:'gpt-5.2-pro',   name:'GPT-5.2 Pro',     price:'Custom',       ctx:'400K',  tier:'flagship', desc:'Maximum quality â€” extended reasoning context. Best for multi-step planning tasks.' },
          { id:'gpt-5.1',       name:'GPT-5.1',         price:'~$1.25 / $10', ctx:'400K',  tier:'flagship', desc:'Previous flagship, still excellent. No current deprecation planned.' },
          { id:'gpt-5',         name:'GPT-5',            price:'$1.25 / $10',  ctx:'400K',  tier:'flagship', desc:'Solid frontier model. Native JSON mode. Strong for structured outputs.' },
          { id:'o3',            name:'o3',               price:'$2.60 / $10.4',ctx:'200K',  tier:'flagship', desc:'Deliberate step-by-step reasoning. Excels at multi-hop logic and planning.' },
          { id:'o3-mini',       name:'o3-mini',          price:'$1.10 / $4.4', ctx:'200K',  tier:'flagship', desc:'Efficient reasoning. Good cost/quality balance for advisor roles.' },
          { id:'gpt-4.1',       name:'GPT-4.1',         price:'$2.00 / $8',   ctx:'1M',    tier:'fast',     desc:'1M context window. Strong for long-document work. Proven in production.' },
          { id:'gpt-4.1-mini',  name:'GPT-4.1 mini',    price:'$0.40 / $1.60',ctx:'1M',    tier:'fast',     desc:'Cost-efficient with massive context. Good for high-volume feedback loops.' },
          { id:'gpt-4.1-nano',  name:'GPT-4.1 nano',    price:'$0.10 / $0.40',ctx:'1M',    tier:'cheap',    desc:'Cheapest 1M-context model available. Simple classification tasks.' },
          { id:'gpt-5-mini',    name:'GPT-5 mini',       price:'$0.25 / $2',   ctx:'128K',  tier:'fast',     desc:'Best value for quality. Native JSON mode. Recommended for advisor/feedback roles.' },
          { id:'gpt-5-nano',    name:'GPT-5 nano',       price:'$0.05 / $0.40',ctx:'32K',   tier:'cheap',    desc:'Cheapest structured output model. Tight context â€” best for scoring tasks only.' },
        ]
      }
    ]
  },

  /* â”€â”€ Slot 1: Anthropic Messages API (locked to Anthropic) â”€â”€â”€ */
  {
    label: 'Slot 2',
    type: 'Anthropic Messages API',
    color: 'var(--c-anthropic)',
    keyField: 'keyAnthropic',
    configKey: 'anthropic',
    fixed: true,
    defaultModel: 'claude-opus-4-5',
    providers: [
      {
        name: 'Anthropic',
        color: 'var(--c-anthropic)',
        baseUrl: 'https://api.anthropic.com/v1',
        models: [
          { id:'claude-opus-4-6',     name:'Claude Opus 4.6',     price:'$5 / $25',   ctx:'200K', tier:'flagship', desc:'67% cheaper than Opus 4.1. Best instruction-following and persona consistency. Top choice for investor/advisor roles.' },
          { id:'claude-sonnet-4-6',   name:'Claude Sonnet 4.6',   price:'$3 / $15',   ctx:'200K', tier:'flagship', desc:'Latest Sonnet â€” best capability-cost ratio in the Claude family. Strong for founder and advisor roles.' },
          { id:'claude-sonnet-4-5',   name:'Claude Sonnet 4.5',   price:'$3 / $15',   ctx:'200K', tier:'flagship', desc:'Optimised for agentic and iterative work. Best coding model in the Claude family.' },
          { id:'claude-opus-4-5',     name:'Claude Opus 4.5',     price:'$5 / $25',   ctx:'200K', tier:'flagship', desc:'80.9% SWE-bench. Exceptional nuanced feedback and multi-criteria scoring. Previous flagship.' },
          { id:'claude-haiku-4-5',    name:'Claude Haiku 4.5',    price:'$1 / $5',    ctx:'200K', tier:'fast',     desc:'Near-frontier quality at 5Ã— lower cost than Sonnet. Fastest Claude. Ideal for feedback rounds.' },
        ]
      }
    ]
  },

  /* â”€â”€ Slot 2: OpenAI-Compatible (any provider) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  {
    label: 'Slot 3',
    type: 'OpenAI-Compatible API',
    color: 'var(--c-compat)',
    keyField: 'keyCompat1',
    configKey: 'deepseek',      // server's existing key for this slot
    fixed: false,               // user picks provider company
    defaultModel: 'deepseek-reasoner',
    defaultProvider: 'DeepSeek',
    defaultBaseUrl: 'https://api.deepseek.com/v1',
    providers: [
      {
        name: 'Google',
        color: 'var(--c-google)',
        baseUrl: 'https://generativelanguage.googleapis.com/v1beta/openai',
        models: [
          { id:'gemini-3.1-pro-preview', name:'Gemini 3.1 Pro Preview', price:'$2 / $12',    ctx:'1M',   tier:'flagship', desc:'94.3% GPQA Diamond. Largest context of any frontier model. Thinking tokens billed as output.' },
          { id:'gemini-3-pro-preview',   name:'Gemini 3 Pro Preview',   price:'$2 / $12',    ctx:'1M',   tier:'flagship', desc:'Stable production flagship. Excellent for technical analysis and long-form reasoning.' },
          { id:'gemini-2.5-pro',         name:'Gemini 2.5 Pro',         price:'$1.25 / $10', ctx:'1M',   tier:'flagship', desc:'Previous generation. Wide ecosystem support. Competitive benchmarks.' },
          { id:'gemini-3-flash',         name:'Gemini 3 Flash',         price:'$0.50 / $3',  ctx:'1M',   tier:'fast',     desc:'Best value for 1M-context tasks. Strong for bulk feedback and multi-document review.' },
          { id:'gemini-2.5-flash',       name:'Gemini 2.5 Flash',       price:'$0.10 / $0.40',ctx:'1M',  tier:'cheap',    desc:'Cheapest 1M-context option. Ideal for high-volume, cost-sensitive feedback rounds.' },
        ]
      },
      {
        name: 'DeepSeek',
        color: 'var(--c-deepseek)',
        baseUrl: 'https://api.deepseek.com/v1',
        models: [
          { id:'deepseek-v3.2-exp',  name:'DeepSeek V3.2 Exp',  price:'$0.28 / $0.42', ctx:'128K', tier:'flagship', desc:'50â€“100Ã— cheaper than frontier closed models. Cache hits near-free at $0.028/M. Best overall value.' },
          { id:'deepseek-reasoner',  name:'DeepSeek Reasoner',  price:'$0.55 / $2.19', ctx:'64K',  tier:'flagship', desc:'Emits chain-of-thought before JSON. Excellent for complex multi-step analysis. JSON extraction handles CoT.' },
          { id:'deepseek-chat',      name:'DeepSeek Chat',      price:'$0.27 / $1.10', ctx:'64K',  tier:'fast',     desc:'Lightest DeepSeek model. Best for high-volume feedback tasks where reasoning depth matters less.' },
        ]
      },
      {
        name: 'Mistral AI',
        color: 'var(--c-mistral)',
        baseUrl: 'https://api.mistral.ai/v1',
        models: [
          { id:'mistral-large-latest',   name:'Mistral Large',    price:'$2 / $6',    ctx:'128K', tier:'flagship', desc:'Strong European-perspective reasoning. Excellent structured output compliance. Competitive pricing.' },
          { id:'mistral-medium-latest',  name:'Mistral Medium',   price:'$0.40 / $2', ctx:'128K', tier:'fast',     desc:'Balanced quality and cost. Good for advisor roles where max capability is not required.' },
          { id:'mistral-small-latest',   name:'Mistral Small',    price:'$0.10 / $0.30',ctx:'128K',tier:'cheap',   desc:'Highly cost-efficient. Reliable JSON output. Great for structured feedback and scoring.' },
          { id:'codestral-latest',       name:'Codestral',        price:'$0.30 / $0.90',ctx:'256K',tier:'fast',   desc:'Optimised for code and technical tasks. Best Mistral model for technical advisor roles.' },
          { id:'ministral-8b-latest',    name:'Ministral 8B',     price:'$0.10 / $0.10',ctx:'128K',tier:'cheap',  desc:'Cheapest Mistral option. Simple tasks, high-volume feedback rounds.' },
        ]
      },
      {
        name: 'xAI',
        color: 'var(--c-xai)',
        baseUrl: 'https://api.x.ai/v1',
        models: [
          { id:'grok-3',      name:'Grok 3',      price:'$3 / $15',   ctx:'131K', tier:'flagship', desc:'Strong real-world reasoning with live knowledge integration. Good analyst persona.' },
          { id:'grok-3-mini', name:'Grok 3 Mini', price:'$0.30 / $0.50',ctx:'131K',tier:'fast',   desc:'Cost-efficient Grok variant. Good reasoning-to-cost ratio for advisor and feedback roles.' },
          { id:'grok-4',      name:'Grok 4',      price:'$30 / $150', ctx:'256K', tier:'flagship', desc:'âš  Most expensive API on the market â€” 6Ã— Claude Opus. Only if you have a specific Grok use case.' },
        ]
      },
      {
        name: 'Meta / Llama',
        color: 'var(--c-meta)',
        baseUrl: 'https://api.together.xyz/v1',
        models: [
          { id:'meta-llama/Llama-4-Maverick-17B-128E-Instruct-FP8', name:'Llama 4 Maverick',  price:'$0.27 / $0.85', ctx:'1M',  tier:'flagship', desc:'Open-weights model via Together AI. Competitive with mid-tier closed models. Self-hostable.' },
          { id:'meta-llama/Llama-4-Scout-17B-16E-Instruct',          name:'Llama 4 Scout',     price:'$0.18 / $0.59', ctx:'10M', tier:'fast',     desc:'Specialised for retrieval and long-context. Largest context window of any model currently available.' },
          { id:'meta-llama/Llama-3.3-70B-Instruct-Turbo',           name:'Llama 3.3 70B',     price:'$0.90 / $0.90', ctx:'128K',tier:'fast',     desc:'Proven and widely deployed. Reliable JSON output. Good challenger/advisor model.' },
          { id:'meta-llama/Llama-3.1-8B-Instruct-Turbo',            name:'Llama 3.1 8B',      price:'$0.18 / $0.18', ctx:'128K',tier:'cheap',    desc:'Extremely cheap inference. Best for bulk feedback rounds where quality tolerance is higher.' },
        ]
      },
      {
        name: 'Qwen / Alibaba',
        color: 'var(--c-qwen)',
        baseUrl: 'https://api.together.xyz/v1',
        models: [
          { id:'Qwen/Qwen3-235B-A22B',     name:'Qwen3 235B',  price:'$0 (preview)', ctx:'131K', tier:'flagship', desc:'235B parameter model, free during preview. Competitive reasoning. Rate limits may apply.' },
          { id:'Qwen/Qwen3-72B',           name:'Qwen3 72B',   price:'~$0.90 / $0.90',ctx:'131K',tier:'fast',    desc:'Strong mid-size open model. Good alternative to Llama 3.3 for structured tasks.' },
          { id:'Qwen/Qwen2.5-Coder-32B-Instruct',name:'Qwen2.5 Coder 32B',price:'~$0.80 / $0.80',ctx:'128K',tier:'fast','desc':'Optimised for code and technical reasoning. Good technical advisor model.' },
        ]
      },
      {
        name: 'Cohere',
        color: 'var(--c-cohere)',
        baseUrl: 'https://api.cohere.ai/v1',
        models: [
          { id:'command-a-03-2025',  name:'Command A',    price:'$2.77 / $13.72', ctx:'256K', tier:'flagship', desc:'Cohere\'s flagship. Optimised for complex agentic tasks, RAG, and multilingual support.' },
          { id:'command-r-plus-08-2024',name:'Command R+', price:'$2.50 / $10',  ctx:'128K', tier:'flagship', desc:'Strong long-context and retrieval-augmented tasks. Solid enterprise track record.' },
          { id:'command-r-08-2024',  name:'Command R',    price:'$0.15 / $0.60', ctx:'128K', tier:'cheap',    desc:'Budget option for structured retrieval and simpler reasoning tasks.' },
        ]
      },
    ]
  },

  /* â”€â”€ Slot 3: OpenAI-Compatible (any provider) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  {
    label: 'Slot 4',
    type: 'OpenAI-Compatible API',
    color: 'var(--c-compat)',
    keyField: 'keyCompat2',
    configKey: 'gemini',        // server's existing key for this slot
    fixed: false,
    defaultModel: 'gemini-3-pro-preview',
    defaultProvider: 'Google',
    defaultBaseUrl: 'https://generativelanguage.googleapis.com/v1beta/openai',
    providers: null,            // reuses slot 2's providers (set in JS)
  },
];

/* State */
const state = {
  selectedSlot: 0,
  models: {},         // slotIndex -> modelId
  providers: {},      // slotIndex -> providerName (for compat slots)
  baseUrls: {},       // slotIndex -> baseUrl
};

/* â”€â”€ Init state from defaults â”€â”€ */
SLOTS.forEach((slot, i) => {
  state.models[i] = slot.defaultModel;
  if (!slot.fixed) {
    state.providers[i] = slot.defaultProvider;
    state.baseUrls[i] = slot.defaultBaseUrl;
  }
});

/* Slot 4 inherits slot 2's provider list */
SLOTS[3].providers = SLOTS[2].providers;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BUILD UI â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildUI() {
  buildSlotStrip();
  buildPickerPanels();
  updateTeamSummary();
  activateSlot(0);
}

function buildSlotStrip() {
  const strip = document.getElementById('slotStrip');
  SLOTS.forEach((slot, i) => {
    const btn = document.createElement('div');
    btn.className = 'slot-btn';
    btn.dataset.slot = i;
    btn.style.color = slot.color;
    btn.onclick = () => activateSlot(i);
    btn.innerHTML = `
      <div class="slot-label"><span class="slot-dot"></span>${slot.label}</div>
      <div class="slot-type" style="font-size:10px;color:var(--text-xs)">${slot.type}</div>
      <div class="slot-selected-name" id="slot-name-${i}">Loadingâ€¦</div>
      <div class="slot-selected-price" id="slot-price-${i}"></div>`;
    strip.appendChild(btn);
  });
}

function buildPickerPanels() {
  const container = document.getElementById('pickerPanels');
  SLOTS.forEach((slot, si) => {
    const panel = document.createElement('div');
    panel.className = 'picker-panel';
    panel.id = `picker-${si}`;
    panel.style.color = slot.color;

    // For fixed slots, no provider tabs needed
    if (!slot.fixed) {
      // Provider selector
      const provSel = document.createElement('div');
      provSel.className = 'provider-selector';
      provSel.id = `prov-sel-${si}`;
      slot.providers.forEach(prov => {
        const tab = document.createElement('div');
        tab.className = 'prov-tab';
        tab.dataset.prov = prov.name;
        tab.style.color = prov.color;
        tab.innerHTML = `<span class="pd" style="background:${prov.color}"></span>${prov.name}`;
        tab.onclick = () => switchProvider(si, prov.name);
        provSel.appendChild(tab);
      });
      panel.appendChild(provSel);
    }

    // Model list container
    const scroll = document.createElement('div');
    scroll.className = 'model-scroll';
    scroll.id = `model-list-${si}`;
    panel.appendChild(scroll);

    // Base URL row (compat slots only)
    if (!slot.fixed) {
      const urlRow = document.createElement('div');
      urlRow.className = 'base-url-row';
      urlRow.innerHTML = `
        <label style="font-size:9px;letter-spacing:1px;white-space:nowrap">Base URL</label>
        <input type="text" id="baseurl-${si}" value="${slot.defaultBaseUrl || ''}" placeholder="https://api.provider.com/v1" style="font-family:var(--font-mono);font-size:11px">`;
      panel.appendChild(urlRow);
      document.getElementById; // ensure DOM is ready later
      // update state when user types
      panel.querySelector('input').addEventListener('input', e => {
        state.baseUrls[si] = e.target.value;
      });
    }

    container.appendChild(panel);
  });

  // Populate model lists
  SLOTS.forEach((slot, si) => {
    const prov = slot.fixed ? slot.providers[0] : slot.providers.find(p => p.name === state.providers[si]);
    renderModelList(si, prov);
    if (!slot.fixed) activateProviderTab(si, state.providers[si]);
  });
}

function renderModelList(si, prov) {
  const list = document.getElementById(`model-list-${si}`);
  if (!list || !prov) return;
  const slot = SLOTS[si];
  list.innerHTML = '';
  prov.models.forEach(m => {
    const isSelected = state.models[si] === m.id;
    const row = document.createElement('label');
    row.className = `model-row${isSelected ? ' selected' : ''}`;
    row.style.color = slot.color;
    row.dataset.id = m.id;
    row.innerHTML = `
      <input type="radio" name="m-${si}" value="${m.id}" ${isSelected ? 'checked' : ''}>
      <div class="model-radio-dot"></div>
      <div class="model-info">
        <div class="model-name">${m.name}</div>
        <div class="model-tagrow">
          <span class="tag price">${m.price}</span>
          <span class="tag ctx">${m.ctx} ctx</span>
          ${m.tier === 'flagship' ? '<span class="tag tier-flagship">flagship</span>' : ''}
          ${m.tier === 'fast' ? '<span class="tag tier-fast">efficient</span>' : ''}
          ${m.tier === 'cheap' ? '<span class="tag tier-cheap">budget</span>' : ''}
        </div>
        <div class="model-desc">${m.desc}</div>
      </div>`;
    row.onclick = () => selectModel(si, m.id, prov);
    list.appendChild(row);
  });
  updateSlotHeader(si);
}

function selectModel(si, modelId, prov) {
  state.models[si] = modelId;
  document.querySelectorAll(`#model-list-${si} .model-row`).forEach(row => {
    row.classList.toggle('selected', row.dataset.id === modelId);
    row.querySelector('input').checked = row.dataset.id === modelId;
  });
  updateSlotHeader(si);
  updateTeamSummary();
}

function switchProvider(si, provName) {
  state.providers[si] = provName;
  const prov = SLOTS[si].providers.find(p => p.name === provName);
  if (!prov) return;
  // Auto-fill base URL
  const urlInput = document.getElementById(`baseurl-${si}`);
  if (urlInput) { urlInput.value = prov.baseUrl; state.baseUrls[si] = prov.baseUrl; }
  // Set default model for this provider
  if (!prov.models.find(m => m.id === state.models[si])) {
    state.models[si] = prov.models[0].id;
  }
  activateProviderTab(si, provName);
  renderModelList(si, prov);
}

function activateProviderTab(si, provName) {
  const sel = document.getElementById(`prov-sel-${si}`);
  if (!sel) return;
  sel.querySelectorAll('.prov-tab').forEach(t => {
    t.classList.toggle('active', t.dataset.prov === provName);
  });
}

function activateSlot(si) {
  state.selectedSlot = si;
  document.querySelectorAll('.slot-btn').forEach(b => b.classList.toggle('active', parseInt(b.dataset.slot) === si));
  document.querySelectorAll('.picker-panel').forEach(p => p.classList.toggle('active', p.id === `picker-${si}`));
}

function updateSlotHeader(si) {
  const slot = SLOTS[si];
  const prov = slot.fixed ? slot.providers[0] : slot.providers.find(p => p.name === state.providers[si]);
  const model = prov?.models.find(m => m.id === state.models[si]);
  const nameEl = document.getElementById(`slot-name-${si}`);
  const priceEl = document.getElementById(`slot-price-${si}`);
  if (nameEl) nameEl.textContent = model?.name ?? 'â€”';
  if (priceEl) priceEl.textContent = model?.price ?? '';
}

function updateTeamSummary() {
  const summary = document.getElementById('teamSummary');
  const chips = SLOTS.map((slot, si) => {
    const prov = slot.fixed ? slot.providers[0] : slot.providers.find(p => p.name === state.providers[si]);
    const model = prov?.models.find(m => m.id === state.models[si]);
    const provLabel = slot.fixed ? '' : `${state.providers[si]} Â· `;
    return `<div class="team-chip">
      <div class="team-chip-dot" style="background:${slot.color}"></div>
      <span style="color:var(--text-xs);margin-right:2px">${slot.label}:</span>
      ${provLabel}${model?.name ?? 'â€”'}
    </div>`;
  });
  summary.innerHTML = chips.join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODE TOGGLE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('cfgMock').addEventListener('change', e => {
  const live = e.target.value === 'false';
  ['keyOpenai','keyAnthropic','keyCompat1','keyCompat2'].forEach(id => {
    const el = document.getElementById(id);
    el.disabled = !live;
    el.style.opacity = live ? 1 : 0.35;
  });
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TAB SWITCHING â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function switchTab(tab) {
  document.querySelectorAll('.main-tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tab));
  document.querySelectorAll('.tab-pane').forEach(p => p.classList.toggle('active', p.id === `pane-${tab}`));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• WEBSOCKET â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let ws, currentRunId;

function connectWS() {
  const proto = location.protocol === 'https:' ? 'wss:' : 'ws:';
  ws = new WebSocket(`${proto}//${location.host}/ws`);
  ws.onopen = () => { document.getElementById('wsDot').classList.add('live'); document.getElementById('wsLabel').textContent = 'Live'; };
  ws.onclose = () => { document.getElementById('wsDot').classList.remove('live'); document.getElementById('wsLabel').textContent = 'Reconnectingâ€¦'; setTimeout(connectWS, 2000); };
  ws.onmessage = e => { const ev = JSON.parse(e.data); if (ev.type !== 'pong') handleEvent(ev); };
}

function handleEvent(ev) {
  document.getElementById('progressBlock').classList.add('visible');
  const pills = { stage1:'pill1', stage2:'pill2', stage3:'pill3' };
  if (ev.type === 'stage_start') {
    Object.values(pills).forEach(id => document.getElementById(id).classList.remove('active'));
    const p = pills[ev.stage]; if (p) document.getElementById(p).classList.add('active');
    document.getElementById('progressSub').textContent = ev.message || ev.stage;
  }
  if (ev.type === 'stage_complete') {
    const p = pills[ev.stage];
    if (p) { const el = document.getElementById(p); el.classList.remove('active'); el.classList.add('done'); }
  }
  const pct = { stage1_stage_start:5, stage1_stage_complete:33, stage2_stage_start:37, stage2_stage_complete:66, stage3_stage_start:70, stage3_stage_complete:100 };
  const k = `${ev.stage}_${ev.type}`; if (pct[k]) document.getElementById('pbarFill').style.width = pct[k] + '%';
  if (ev.type === 'step_complete') { const c = parseFloat(document.getElementById('pbarFill').style.width) || 0; document.getElementById('pbarFill').style.width = Math.min(c+1.5, 94) + '%'; }
  if (ev.type === 'pipeline_complete') {
    document.getElementById('pbarFill').style.width = '100%';
    document.getElementById('progressSub').textContent = 'Complete âœ“';
    document.getElementById('btnRun').disabled = false;
    document.getElementById('runStatus').textContent = '';
    if (currentRunId) loadResults(currentRunId);
    loadRuns();
  }
  if (ev.type === 'pipeline_error') {
    document.getElementById('progressSub').textContent = 'Error: ' + ev.message;
    document.getElementById('btnRun').disabled = false;
    document.getElementById('runStatus').textContent = '';
  }
  appendEvent(ev);
}

function appendEvent(ev) {
  const log = document.getElementById('eventLog');
  const ts = new Date(ev.timestamp * 1000).toLocaleTimeString('en', { hour:'2-digit', minute:'2-digit', second:'2-digit' });
  const div = document.createElement('div');
  div.className = 'event-row';
  div.innerHTML = `<span class="ets">${ts}</span><span class="etyp">${ev.type}</span><span class="emsg">${ev.message||''}</span>${ev.provider ? `<span class="eprov">[${ev.provider}]</span>` : ''}`;
  log.appendChild(div);
  log.scrollTop = log.scrollHeight;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• START RUN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function startRun() {
  const btn = document.getElementById('btnRun');
  btn.disabled = true;
  document.getElementById('runStatus').textContent = 'Startingâ€¦';
  ['pill1','pill2','pill3'].forEach(id => document.getElementById(id).classList.remove('active','done'));
  document.getElementById('pbarFill').style.width = '0%';
  document.getElementById('eventLog').innerHTML = '';
  document.getElementById('progressBlock').classList.add('visible');
  document.getElementById('progressSub').textContent = 'Initialising pipelineâ€¦';

  const useMock = document.getElementById('cfgMock').value === 'true';

  const config = {
    use_mock: useMock,
    max_iterations: parseInt(document.getElementById('cfgIter').value),
    ideas_per_provider: parseInt(document.getElementById('cfgIdeas').value),
    sector_focus: document.getElementById('cfgSector').value.trim(),
    concurrency: 1, retry_max: 3,
    models: {
      openai:   state.models[0],
      anthropic: state.models[1],
      deepseek: state.models[2],
      gemini:   state.models[3],
    },
    // base_urls forwarded so server can pass them to run_pipeline (see bug spec)
    base_urls: {
      deepseek: state.baseUrls[2] || '',
      gemini:   state.baseUrls[3] || '',
    },
  };

  if (!useMock) {
    config.api_keys = {
      OPENAI_API_KEY:     document.getElementById('keyOpenai').value,
      ANTHROPIC_API_KEY:  document.getElementById('keyAnthropic').value,
      OPENAI_COMPAT_API_KEY: document.getElementById('keyCompat1').value,
      GEMINI_API_KEY:     document.getElementById('keyCompat2').value,
    };
  }

  try {
    const resp = await fetch('/api/runs', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(config) });
    const data = await resp.json();
    currentRunId = data.run_id;
    document.getElementById('runStatus').textContent = data.run_id;
  } catch(err) {
    btn.disabled = false;
    document.getElementById('runStatus').textContent = 'Failed: ' + err.message;
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LOAD RUNS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function loadRuns() {
  try {
    const resp = await fetch('/api/runs');
    const runs = await resp.json();
    const container = document.getElementById('runsList');
    if (!runs.length) { container.innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ“‹</div><h3>No runs yet</h3><p>Configure the panel above and click Launch.</p></div>`; return; }
    let html = `<div class="card"><table class="data-table"><thead><tr><th>Run ID</th><th>Status</th><th>Mode</th><th>Sector</th><th>Events</th><th>Started</th><th></th></tr></thead><tbody>`;
    for (const run of [...runs].reverse()) {
      const started = run.started_at ? new Date(run.started_at * 1000).toLocaleString() : 'â€”';
      const mode = run.config?.use_mock ? 'Mock' : 'Live';
      const sector = run.config?.sector_focus || 'All sectors';
      html += `<tr>
        <td style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim)">${run.run_id}</td>
        <td><span class="status-badge ${run.status}">${run.status}${run.error ? ': ' + run.error.substring(0,40) : ''}</span></td>
        <td style="color:var(--text-dim)">${mode}</td>
        <td style="color:var(--text-dim)">${sector}</td>
        <td style="font-family:var(--font-mono);color:var(--text-xs)">${run.event_count}</td>
        <td style="color:var(--text-xs);font-size:12px">${started}</td>
        <td>${run.status === 'complete' ? `<button class="btn btn-ghost" onclick="loadResults('${run.run_id}')" style="padding:4px 12px;font-size:11px">View â†’</button>` : ''}</td>
      </tr>`;
    }
    html += '</tbody></table></div>';
    container.innerHTML = html;
  } catch(e) {}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LOAD RESULTS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function loadResults(runId) {
  try {
    const resp = await fetch(`/api/runs/${runId}/results`);
    if (!resp.ok) return;
    const r = await resp.json();
    renderIdeas(r.stage1_ideas || []);
    renderPlans(r.stage2_final_plans || []);
    renderPitches(r.stage3_pitches || [], r.stage3_decisions || []);
    renderPortfolio(r.portfolio_report || []);
    switchTab('portfolio');
  } catch(e) {}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RENDER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderIdeas(ideas) {
  const el = document.getElementById('ideasContent');
  if (!ideas.length) { el.innerHTML = emptyState('ğŸ’¡','No ideas','Run the pipeline to generate ideas.'); return; }
  let html = '<div class="idea-grid">';
  for (const idea of ideas) {
    const prov = (idea.proposer_provider || '').toLowerCase();
    html += `<div class="idea-card">
      <div class="idea-top">
        <div class="idea-title">${esc(idea.title)}</div>
        <span class="provider-badge ${prov}">${esc(idea.proposer_provider)}</span>
      </div>
      <p class="idea-summary">${esc(idea.summary)}</p>
      <div class="idea-details">
        <div class="idea-drow"><span class="idea-dlabel">Target</span><span class="idea-dval">${esc(idea.target_customer)}</span></div>
        <div class="idea-drow"><span class="idea-dlabel">Why now</span><span class="idea-dval">${esc(idea.why_now)}</span></div>
        <div class="idea-drow"><span class="idea-dlabel">Market</span><span class="idea-dval">${esc(idea.market_size_estimate)}</span></div>
        <div class="idea-drow"><span class="idea-dlabel">Moat</span><span class="idea-dval">${esc(idea.unfair_advantage)}</span></div>
      </div>
    </div>`;
  }
  el.innerHTML = html + '</div>';
}

function renderPlans(plans) {
  const el = document.getElementById('plansContent');
  if (!plans.length) { el.innerHTML = emptyState('ğŸ“','No plans','Plans appear after Stage 2.'); return; }
  let html = '<div class="plan-accordion">';
  for (const p of plans) {
    const prov = (p.founder_provider || '').toLowerCase();
    const comps = (p.competitive_landscape || []).map(c => `<div class="competitor-row"><div class="competitor-name">${esc(c.competitor)}</div><div class="competitor-meta"><div class="competitor-fact"><strong>Strength</strong>${esc(c.strength)}</div><div class="competitor-fact"><strong>Weakness</strong>${esc(c.weakness)}</div><div class="competitor-fact" style="grid-column:1/-1"><strong>Our edge</strong>${esc(c.our_advantage)}</div></div></div>`).join('');
    const risks = (p.risks_and_mitigations || []).map(r => `<div class="risk-row"><span class="risk-badge ${r.severity}">${r.severity}</span><div class="risk-text">${esc(r.risk)} â€” <em>${esc(r.mitigation)}</em></div></div>`).join('');
    html += `<details class="plan-item">
      <summary>
        <div class="plan-chevron"><svg viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg></div>
        <div class="plan-summary-text">
          <strong><span class="provider-badge ${prov}" style="margin-right:8px">${esc(p.founder_provider)}</span>${esc(p.idea_id)}</strong>
          <span>${esc((p.problem||'').substring(0,90))}â€¦</span>
        </div>
      </summary>
      <div class="plan-body">
        <div class="plan-sec full"><h4>Problem</h4><p>${esc(p.problem)}</p></div>
        <div class="plan-sec full"><h4>Solution</h4><p>${esc(p.solution)}</p></div>
        <div class="plan-sec">
          <h4>Market</h4>
          <div class="market-grid">
            <div class="market-cell"><div class="market-cell-label">TAM</div><div class="market-cell-val">${esc(p.market?.tam)}</div></div>
            <div class="market-cell"><div class="market-cell-label">SAM</div><div class="market-cell-val">${esc(p.market?.sam)}</div></div>
            <div class="market-cell"><div class="market-cell-label">SOM</div><div class="market-cell-val">${esc(p.market?.som)}</div></div>
          </div>
          <p style="font-size:11px;color:var(--text-xs)">${esc(p.market?.reasoning)}</p>
        </div>
        <div class="plan-sec">
          <h4>Business Model</h4>
          <p><strong>${esc(p.business_model?.revenue_model)}</strong><br>${esc(p.business_model?.pricing)}<br>${esc(p.business_model?.unit_economics)}</p>
        </div>
        <div class="plan-sec full"><h4>Go-to-Market</h4><p>${esc(p.go_to_market)}</p></div>
        <div class="plan-sec"><h4>Competitive Landscape</h4><div class="competitor-list">${comps}</div></div>
        <div class="plan-sec"><h4>Risks &amp; Mitigations</h4><div class="risk-list">${risks}</div></div>
        <div class="plan-sec full"><h4>12-Month Roadmap</h4><p>${esc(p.twelve_month_roadmap)}</p></div>
        <div class="plan-sec full"><h4>Funding Ask</h4><p><strong>${esc(p.funding_ask?.amount)}</strong> â€” ${esc(p.funding_ask?.proposed_valuation)}<br>${esc(p.funding_ask?.use_of_funds)}<br>Targets: ${esc(p.funding_ask?.target_metrics)}</p></div>
      </div>
    </details>`;
  }
  el.innerHTML = html + '</div>';
}

function renderPitches(pitches, decisions) {
  const el = document.getElementById('pitchesContent');
  if (!pitches.length) { el.innerHTML = emptyState('ğŸ¤','No pitches yet','Pitches appear after Stage 3.'); return; }
  let html = '<div class="pitch-grid">';
  for (const pitch of pitches) {
    const prov = (pitch.founder_provider || '').toLowerCase();
    const dd = decisions.filter(d => d.idea_id === pitch.idea_id);
    const investN = dd.filter(d => d.decision === 'invest').length;
    const avgConv = dd.length ? (dd.reduce((s,d) => s + d.conviction_score, 0) / dd.length).toFixed(1) : 'â€”';
    const convCl = parseFloat(avgConv) >= 7 ? '#22c55e' : parseFloat(avgConv) >= 5 ? '#eab308' : '#ef4444';
    html += `<div class="pitch-card">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:8px;margin-bottom:4px">
        <span class="provider-badge ${prov}">${esc(pitch.founder_provider)}</span>
        <span style="font-family:var(--font-mono);font-size:10px;color:var(--text-xs)">${esc(pitch.idea_id)}</span>
      </div>
      <div class="pitch-elevator">${esc(pitch.elevator_pitch)}</div>
      <div class="pitch-ask"><strong style="font-size:10px;text-transform:uppercase;letter-spacing:.5px;color:var(--text-xs)">The Ask</strong><br>${esc(pitch.the_ask)}</div>
      <div class="investor-votes">
        <div class="vote-header">
          <span class="vote-header-label">${investN}/${dd.length} invest</span>
          <span class="vote-score-big" style="color:${convCl}">${avgConv}</span>
        </div>
        ${dd.map(d => `<div class="vote-row">
          <span class="vote-dec ${d.decision}">${d.decision.toUpperCase()}</span>
          <span class="vote-investor"><span class="provider-badge ${(d.investor_provider||'').toLowerCase()}">${esc(d.investor_provider)}</span></span>
          <span class="vote-conv">${d.conviction_score}/10</span>
        </div>${d.proposed_terms ? `<div style="padding:0 0 5px 70px;font-size:11px;color:var(--text-xs)">${esc(d.proposed_terms.check_size)} @ ${esc(d.proposed_terms.valuation_range)}</div>` : ''}`).join('')}
      </div>
    </div>`;
  }
  el.innerHTML = html + '</div>';
}

function renderPortfolio(report) {
  const el = document.getElementById('portfolioContent');
  if (!report.length) { el.innerHTML = emptyState('ğŸ†','Portfolio pending','Ranked results appear once the pipeline completes.'); return; }
  const topConv = Math.max(...report.map(r => parseFloat(r.avg_conviction) || 0));
  let rows = '';
  report.forEach(row => {
    const rank = parseInt(row.rank);
    const rankCl = rank <= 3 ? `rank-${rank}` : '';
    const conv = parseFloat(row.avg_conviction) || 0;
    const convColor = conv >= 7 ? '#22c55e' : conv >= 5 ? '#eab308' : '#ef4444';
    const prov = (row.founder || '').toLowerCase();
    const votesPct = row.investors_total > 0 ? Math.round((row.investors_in / row.investors_total) * 100) : 0;
    const circ = 2 * Math.PI * 19, dash = (conv / 10) * circ;
    rows += `<tr>
      <td style="text-align:center"><div class="rank-num ${rankCl}">#${rank}</div></td>
      <td>
        <span class="provider-badge ${prov}">${esc(row.founder)}</span>
        <br><span style="font-family:var(--font-mono);font-size:10px;color:var(--text-xs);margin-top:3px;display:block">${esc(row.idea_id)}</span>
      </td>
      <td class="pitch-cell">${esc(row.elevator_pitch)}</td>
      <td>
        <div class="votes-fraction">${row.investors_in}<span style="color:var(--text-xs);font-size:12px">/${row.investors_total}</span></div>
        <div class="votes-bar"><div class="votes-bar-fill" style="width:${votesPct}%"></div></div>
      </td>
      <td style="text-align:center">
        <div class="conviction-ring">
          <svg width="46" height="46" viewBox="0 0 46 46">
            <circle cx="23" cy="23" r="19" fill="none" stroke="rgba(255,255,255,.06)" stroke-width="3.5"/>
            <circle cx="23" cy="23" r="19" fill="none" stroke="${convColor}" stroke-width="3.5"
              stroke-dasharray="${dash} ${circ}" stroke-linecap="round"/>
          </svg>
          <div class="val" style="color:${convColor}">${conv.toFixed(1)}</div>
        </div>
      </td>
      <td class="ask-cell">${esc(row.funding_ask)}</td>
    </tr>`;
  });
  el.innerHTML = `<div class="portfolio-hero">
    <div class="portfolio-header">
      <div>
        <div class="portfolio-title">Portfolio Report</div>
        <div class="portfolio-subtitle">Ranked by investor conviction Â· ${report.length} startup${report.length !== 1 ? 's' : ''} evaluated</div>
      </div>
      <div class="portfolio-meta"><span>Peak conviction</span><strong>${topConv.toFixed(1)}/10</strong></div>
    </div>
    <div class="portfolio-table-wrap">
      <table class="portfolio-table">
        <thead><tr><th>Rank</th><th>Founder</th><th>Elevator Pitch</th><th>Investors</th><th>Conviction</th><th>Ask</th></tr></thead>
        <tbody>${rows}</tbody>
      </table>
    </div>
  </div>`;
}

function emptyState(icon, title, desc) {
  return `<div class="empty-state"><div class="empty-icon">${icon}</div><h3>${title}</h3><p>${desc}</p></div>`;
}
function esc(s) {
  if (s == null) return '';
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• INIT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
buildUI();
connectWS();
loadRuns();
</script>
</body>
</html>
